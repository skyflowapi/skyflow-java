name: Publish package to the JFROG Artifactory
on:
  push:
    tags-ignore:
      - '*.*'
    paths-ignore:
      - "pom.xml"
      - "*.md"
    branches:
      - release/*

jobs:
  build-and-deploy:
    uses: ./.github/workflows/shared-build-and-deploy.yml
    with:
      ref: ${{ github.ref_name }}
      server-id: central
      profile: jfrog
      tag: 'internal'
    secrets:
      server-username: ${{ secrets.ARTIFACTORY_USERNAME }}
      server-password: ${{ secrets.ARTIFACTORY_PASSWORD }}
      gpg-key: ${{ secrets.JFROG_GPG_KEY }}
      gpg-passphrase: ${{ secrets.JFROG_GPG_PASSPHRASE }}
      skyflow-credentials: ${{ secrets.SKYFLOW_CREDENTIALS }} >> .env
      test-expired-token: ${{ secrets.TEST_EXPIRED_TOKEN }} >> .env
      test-reusable-token: ${{ secrets.TEST_REUSABLE_TOKEN }} >> .env
      vault-client-creds: ${{ secrets.VAULT_CLIENT_SKYFLOW_CREDENTIALS }} >> .env
